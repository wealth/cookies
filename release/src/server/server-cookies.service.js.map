{"version":3,"file":"server-cookies.service.js","sourceRoot":"","sources":["../../../src/server/server-cookies.service.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAEnD,OAAO,EAAE,cAAc,EAAE,MAAM,oBAAoB,CAAC;AACpD,OAAO,EAAE,qBAAqB,EAAE,MAAM,4BAA4B,CAAC;AAEnE,OAAO,EAAE,QAAQ,EAAE,YAAY,EAAE,MAAM,UAAU,CAAC;AAElD;IAC0C,wCAAc;IAGtD,8BAAY,cAAqC,EACV,OAAY,EACX,QAAa;QAFrD,YAGE,kBAAM,cAAc,CAAC,SACtB;QAHsC,aAAO,GAAP,OAAO,CAAK;QACX,cAAQ,GAAR,QAAQ,CAAK;QAJ7C,gBAAU,GAA2C,EAAE,CAAC;;IAMhE,CAAC;IAES,4CAAa,GAAvB;QACE,IAAM,UAAU,gBAA+B,IAAI,CAAC,OAAO,CAAC,OAAO,EAAK,IAAI,CAAC,UAAU,CAAC,CAAC;QACzF,IAAM,OAAO,GAA2B,EAAE,CAAC;QAC3C,GAAG,CAAC,CAAC,IAAM,MAAI,IAAI,UAAU,CAAC,CAAC,CAAC;YAC9B,EAAE,CAAC,CAAC,OAAO,UAAU,CAAC,MAAI,CAAC,KAAK,WAAW,CAAC,CAAC,CAAC;gBAC5C,OAAO,CAAC,MAAI,CAAC,GAAG,UAAU,CAAC,MAAI,CAAC,CAAC;YACnC,CAAC;QACH,CAAC;QACD,MAAM,CAAC,OAAO,CAAC;IACjB,CAAC;IAES,4CAAa,GAAvB;QAAA,iBAKC;QAJC,MAAM,CAAC,UAAC,IAAY,EAAE,KAAyB,EAAE,OAAwB;YACvE,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;YAC9B,KAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE,KAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,CAAC;QACvE,CAAC,CAAC;IACJ,CAAC;IAEO,kDAAmB,GAA3B,UAA4B,OAAwB;QAClD,IAAI,IAAI,GAAmB,YAAY,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QAC/D,EAAE,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAC3B,IAAI,CAAC,OAAO,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACxC,CAAC;QACD,MAAM,CAAC,IAAI,CAAC;IACd,CAAC;;gBAlCF,UAAU;;;;gBAJF,qBAAqB;gDASf,MAAM,SAAC,SAAS;gDAChB,MAAM,SAAC,UAAU;;IA6BhC,2BAAC;CAAA,AAnCD,CAC0C,cAAc,GAkCvD;SAlCY,oBAAoB","sourcesContent":["import { Inject, Injectable } from '@angular/core';\n\nimport { CookiesService } from '../cookies.service';\nimport { CookiesOptionsService } from '../cookies-options.service';\nimport { CookiesOptions } from '../cookies-options';\nimport { isString, mergeOptions } from '../utils';\n\n@Injectable()\nexport class ServerCookiesService extends CookiesService {\n  private newCookies: { [name: string]: string | undefined } = {};\n\n  constructor(cookiesOptions: CookiesOptionsService,\n              @Inject('REQUEST') private request: any,\n              @Inject('RESPONSE') private response: any) {\n    super(cookiesOptions);\n  }\n\n  protected cookiesReader(): { [key: string]: any } {\n    const allCookies: { [key: string]: any } = {...this.request.cookies, ...this.newCookies};\n    const cookies: { [key: string]: any } = {};\n    for (const name in allCookies) {\n      if (typeof allCookies[name] !== 'undefined') {\n        cookies[name] = allCookies[name];\n      }\n    }\n    return cookies;\n  }\n\n  protected cookiesWriter(): (name: string, value: string | undefined, options?: CookiesOptions) => void {\n    return (name: string, value: string | undefined, options?: CookiesOptions) => {\n      this.newCookies[name] = value;\n      this.response.cookie(name, value, this.buildCookiesOptions(options));\n    };\n  }\n\n  private buildCookiesOptions(options?: CookiesOptions): CookiesOptions {\n    let opts: CookiesOptions = mergeOptions(this.options, options);\n    if (isString(opts.expires)) {\n      opts.expires = new Date(opts.expires);\n    }\n    return opts;\n  }\n}\n"]}